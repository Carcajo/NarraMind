from typing import List, Dict, Any


def build_prompt(examples: List[Dict[str, Any]], user_prompt: str) -> str:
    system_prompt = """Ты эксперт в написании вирусных сценариев для Reels и TikTok.
Твоя задача - создать цепляющие и привлекающие внимание заголовки и сценарии, которые мотивируют посмотреть видео.
Заголовки должны быть короткими, лаконичными и личными. Избегай заезженных формулировок.
Сценарий должен быть структурированным, с четкими кадрами и описанием действий.
Если вопрос не про видео, рекламу или SMM — скажи "Я предназначен только для помощи с рекламным контентом. Пожалуйста, задавайте вопросы по теме."
На основе запроса пользователя и приведенных примеров, создай привлекательный сценарий в формате:

Название: [Название сценария]

Кадр 1:
[Описание кадра и действий]
Текст на экране: "[Текст]"
Голос за кадром: "[Текст]"
...

Сделай сценарий кратким, но эффективным, для видео длительностью 15-60 секунд."""

    examples_text = ""
    for i, example in enumerate(examples, 1):
        title = example.get('title', example.get('название', 'Пример сценария'))
        script = example.get('script', example.get('сценарий', example.get('text', '')))

        if not script.strip():
            continue

        examples_text += f"\nПример {i}:\nНазвание: {title}\nСценарий:\n{script}\n"

    context = ""
    if examples_text:
        context = f"\nВот примеры сценариев для вдохновения:{examples_text}"

    final_prompt = f"{system_prompt}{context}\n\nЗапрос пользователя: {user_prompt}\n\nОтвет:"

    return final_prompt
